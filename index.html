<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Schrödinger Baseball - Single Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #050507; --cyan: #00f2ff; --purple: #bc13fe; --green: #00ff41; --red: #ff4b2b; 
            --unit: 1vh; 
        }
        
        html { height: 100%; overflow: hidden; }
        body { 
            background: linear-gradient(rgba(5, 5, 7, 0.8), rgba(5, 5, 7, 0.8)), url('cat footage.gif');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; 
            align-items: center; justify-content: flex-start; height: 100vh; margin: 0; padding: 0;
            overflow: hidden; user-select: none; -webkit-user-select: none;
        }

        #version-tag { position: fixed; bottom: 1.5vh; left: 2vh; color: #555; font-family: 'Orbitron', sans-serif; font-size: 2.4vh; letter-spacing: 0.1vh; z-index: 500; }
        #sound-control { position: fixed; right: 2vh; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; align-items: center; gap: 1vh; background: rgba(0,0,0,0.7); padding: 1.5vh 1vh; border-radius: 3vh; border: 0.1vh solid var(--cyan); z-index: 10000; }
        #sound-control input[type=range] { -webkit-appearance: slider-vertical; width: 0.8vh; height: 15vh; cursor: pointer; }
        .sound-icon { font-size: 1.5vh; color: var(--cyan); }

        .title-wrapper { position: relative; margin-top: 5vh; margin-bottom: 3vh; z-index: 300; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }
        .title-bg { position: absolute; background: rgba(0, 0, 0, 0.7); width: 120%; height: 120%; border-radius: 1.5vh; filter: blur(0.5vh); z-index: -1; }
        .header-title { font-size: 5vh; font-weight: bold; letter-spacing: 1.2vh; text-shadow: 0 0 2vh currentColor; animation: neonShift 10s infinite alternate linear; text-align: center; margin: 0; padding: 1vh 4vh; }
        
        @keyframes neonShift { 0% { color: var(--cyan); border-color: var(--cyan); box-shadow: 0 0 2vh var(--cyan); } 100% { color: var(--purple); border-color: var(--purple); box-shadow: 0 0 2vh var(--purple); } }
        @keyframes neonShiftBg { 0% { background-color: var(--cyan); box-shadow: 0 0 1.5vh var(--cyan); } 100% { background-color: var(--purple); box-shadow: 0 0 1.5vh var(--purple); } }
        @keyframes keyholeNeonShift { 0% { filter: drop-shadow(0 0 1.5vh var(--cyan)) drop-shadow(0 0 3vh var(--cyan)); } 100% { filter: drop-shadow(0 0 1.5vh var(--purple)) drop-shadow(0 0 3vh var(--purple)); } }

        .game-container { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 95%; height: auto; padding-bottom: 2vh; }
        #setup { width: 50vh; height: auto; padding: 4vh; border-radius: 2.5vh; background: rgba(10, 10, 15, 0.95); border: 0.4vh solid var(--cyan); z-index: 200; text-align: center; box-sizing: border-box; box-shadow: 0 0 3vh rgba(0, 242, 255, 0.3); display: flex; flex-direction: column; align-items: center; justify-content: center; margin-bottom: 1vh; }
        .setup-box-container { position: relative; width: 35vh; margin-bottom: 2vh; }
        .setup-cat { width: 35vh; height: 35vh; border-radius: 4vh; border: 0.4vh solid var(--green); object-fit: cover; animation: neonShift 10s infinite alternate linear; display: block; }
        .setup-btn { font-family: 'Bebas Neue', cursive; width: 35vh; color: #000; font-weight: 900; height: 7vh; font-size: 3.2vh; border-radius: 1.5vh; cursor: pointer; border: none; animation: neonShiftBg 10s infinite alternate linear; margin-top: 1vh; transition: transform 0.1s, filter 0.2s; letter-spacing: 0.1vh; }
        .tutorial-btn { font-family: 'Bebas Neue', cursive; width: 35vh; background: #444; color: #fff; font-weight: 700; height: 5vh; font-size: 2.5vh; border-radius: 1.5vh; cursor: pointer; border: 0.2vh solid #666; margin-bottom: 1vh; transition: 0.2s; letter-spacing: 0.1vh; }
        .new-keyhole { width: 35vh; height: auto; margin-top: 1.5vh; animation: keyholeNeonShift 10s infinite alternate linear; }

        #game-box, #info-panel { width: 50vh; height: 75vh; padding: 2.5vh; border-radius: 2.5vh; box-sizing: border-box; display: flex; flex-direction: column; flex-shrink: 0; margin-bottom: 3vh; }
        #game-box { background: rgba(17, 17, 17, 0.9); border: 0.1vh solid #333; position: relative; display: none; }
        #info-panel { background: rgba(10, 10, 15, 0.9); border: 0.1vh solid #333; display: none; position: relative; }
        
        .status { text-align:center; margin-bottom:1.5vh; font-weight:bold; height:3vh; font-size: 2.2vh; animation: neonShift 10s infinite alternate linear; transform: translateY(-1vh); }
        #log-window { height: 26vh; background: #000; overflow-y: auto; padding: 1vh; font-family: 'Consolas', monospace; margin-bottom: 1.5vh; border: 0.1vh inset #222; display: grid; grid-template-columns: 1fr 1fr; grid-auto-rows: 8.5vh; gap: 0px; align-content: start; }
        .log-item { padding: 0.5vh; display: flex; flex-direction: column; justify-content: center; background: rgba(0, 242, 255, 0.05); color: var(--cyan); border-bottom: 0.1vh solid #222; position: relative; box-sizing: border-box; text-align: center; }
        .log-item:nth-child(odd) { border-right: 0.1vh solid #333; }
        .log-n { font-family: 'Orbitron', sans-serif; font-size: 3vh; font-weight: 900; display: block; letter-spacing: 0.2vh; color: #fff; }
        .log-sb { font-weight: bold; font-size: 1.8vh; color: var(--purple); margin-top: 0.2vh; }
        .log-out { color: #bc13fe; text-shadow: 0 0 1vh #bc13fe; }

        .chance-area { display: flex; align-items: center; justify-content: space-between; margin-bottom: 2.5vh; gap: 2vh; height: 16vh; position: relative; }
        #chance-box { background: rgba(0,0,0,0.6); padding: 1vh; border-radius: 2vh; border: 0.2vh solid var(--purple); text-align: center; flex: 1; height: 100%; display: flex; flex-direction: column; justify-content: center; box-sizing: border-box; transition: border-color 0.5s; z-index: 5; }
        .chance-title { font-family: 'Bebas Neue', cursive; font-size: 2.4vh; font-weight: bold; display: block; margin-bottom: 0.5vh; }
        .chance-value { font-size: 5.85vh; font-weight: 900; color: var(--purple); text-shadow: 0 0 2.5vh var(--purple); font-family: 'Orbitron', sans-serif; line-height: 1.1; }
        
        .poison-text { font-size: 2.8vh; letter-spacing: -0.1vh; line-height: 1.1; font-weight: 900; display: inline-block; animation: floatingText 3s infinite ease-in-out; } 
        @keyframes floatingText { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-0.8vh); } }

        .prob-cat-container { position: relative; width: 16vh; height: 16vh; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
        .prob-cat { width: 100%; height: 100%; border-radius: 2.5vh; border: 0.2vh solid var(--purple); object-fit: cover; box-sizing: border-box; z-index: 1; }
        #turn-counter { position: absolute; font-weight: 900; font-size: 8vh; z-index: 20; pointer-events: none; transition: transform 2s ease-in-out, color 0.5s; will-change: transform; }

        #candidates-box { flex-grow: 1; overflow: hidden; display: flex; flex-direction: column; position: relative; }
        .cand-title { font-family: 'Bebas Neue', cursive; font-size: 3vh; color:#fff; margin-bottom: 1.5vh; font-weight:bold; text-align: center; padding: 1vh 0; border-top: 0.1vh solid #333; border-bottom: 0.1vh solid #333; }
        #cand-list { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1vh; overflow-y: hidden; overflow-x: hidden; font-family: 'Consolas', monospace; font-size: 1.8vh; color: #fff; flex-grow: 1; align-content: start; }
        .cand-item { padding: 0.4vh 0.2vh; height: 3vh; line-height: 3vh; text-align: center; background: rgba(255,255,255,0.07); border-radius: 0.6vh; will-change: transform; }

        .input-view { background: #000; font-family: 'Orbitron', sans-serif; font-size: 4.5vh; text-align: center; height: 9vh; line-height: 9vh; border-radius: 1.2vh; margin-bottom: 2vh; color: #fff; border: 0.1vh inset #222; letter-spacing: 1.5vh; font-weight: 900; text-shadow: 0 0 1vh var(--cyan); }
        .keypad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1vh; flex-grow: 1; }
        button { background: #222; border: none; color: #fff; padding: 1vh 0; border-radius: 1vh; cursor: pointer; font-size: 2.4vh; box-shadow: 0.2vh 0.2vh 0.5vh rgba(0,0,0,0.5); transition: background 0.2s, transform 0.1s; }
        button:hover:not(:disabled) { filter: brightness(1.3); transform: translateY(-0.2vh); }
        button:active:not(:disabled), button.active { transform: translateY(0.2vh); filter: brightness(0.8); }
        button:disabled { opacity: 0.1; cursor: not-allowed; }
        
        .btn-clr { font-family: 'Bebas Neue', cursive; background: var(--cyan) !important; color: #000 !important; font-weight: bold; font-size: 2.5vh !important; }
        .btn-obs { font-family: 'Bebas Neue', cursive; background: var(--purple); color: #000; font-weight: bold; font-size: 2.5vh !important; }
        .btn-ent { font-family: 'Bebas Neue', cursive; background: var(--green); color: #000; font-weight: bold; grid-row: span 2; font-size: 2.5vh !important; }
        
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.96); flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        #quantum-field { position: absolute; width: 100%; height: 100%; top: 0; left: 0; overflow: hidden; pointer-events: none; z-index: 1001; }
        .bg-candidate { position: absolute; font-family: 'Courier New', monospace; font-size: 6.5vh; font-weight: bold; text-shadow: 0 0 1.5vh currentColor; animation: blinkSync 4s infinite ease-in-out; opacity: 0; }
        @keyframes blinkSync { 0%, 100% { opacity: 0; transform: scale(0.9); } 50% { opacity: 0.7; transform: scale(1.1); } }

        .panel-center { position: relative; z-index: 1010; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; background: #0a0a0c; padding: 5vh; border-radius: 4vh; border: 0.2vh solid var(--purple); width: 60vh; box-shadow: 0 0 10vh rgba(0, 0, 0, 1); }
        #setup-footer { margin-top: 0.5vh; font-size: 1.3vh; color: #888; text-align: center; z-index: 300; line-height: 1.6; }

        #tutorial-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 5000; flex-direction: column; align-items: center; justify-content: center; }
        .tutorial-msg-box { background: #1a1a1a; border: 0.3vh solid #666; padding: 2vh 3vh; border-radius: 2vh; width: 60vh; text-align: center; position: relative; }
        .tutorial-msg-box h3 { color: #ccc; font-size: 2.5vh; margin: 0; }
        .tutorial-msg-box p { font-size: 1.8vh; color: #ddd; line-height: 1.6; margin: 1vh 0; }
        .tutorial-highlight { outline: 0.5vh solid var(--red) !important; box-shadow: 0 0 3vh var(--red) !important; opacity: 1 !important; pointer-events: auto !important; }
        .tutorial-dim { opacity: 0.2 !important; pointer-events: none !important; }

        #credit-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); z-index: 15000; flex-direction: row; align-items: center; justify-content: center; }
        #credit-container { position: relative; width: 50%; height: 100%; border-left: 0.2vh solid rgba(255,255,255,0.3); border-right: 0.2vh solid rgba(255,255,255,0.3); background: rgba(0,0,0,0.98); display: flex; justify-content: center; overflow: hidden; z-index: 15002; }
        #credit-content { position: absolute; top: 100%; width: 90%; text-align: center; color: #ddd; font-size: 2.1vh; line-height: 2.2; white-space: pre-wrap; padding: 10vh 0; }
        .credit-esc { position: fixed; bottom: 3vh; right: 3vh; color: #666; font-size: 1.5vh; z-index: 15003; }
        #flash-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 20000; opacity: 0; transition: opacity 1.5s ease; }
        #dead-x { display: none; position: absolute; top: 62%; left: 50%; transform: translate(-50%, -50%); font-size: 30vh; color: var(--green); text-shadow: 0 0 4vh var(--green); font-weight: 900; opacity: 0.8; z-index: 100; }
        .emoji-lane { position: fixed; white-space: nowrap; font-size: 5vh; pointer-events: none; z-index: 5; opacity: 0.6; }
        @keyframes slide-h { from { transform: translateX(-150%); } to { transform: translateX(150vw); } }
        @keyframes slide-v { from { transform: translateY(150vh); } to { transform: translateY(-150%); } }
    </style>
</head>
<body oncontextmenu="return false">

<div id="version-tag">1.1 version</div>
<div id="flash-overlay"></div>

<div id="sound-control">
    <span class="sound-icon">♪</span>
    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.15" oninput="adjustVolume(this.value)">
    <span class="sound-icon" style="font-size:1vh;">VOL</span>
</div>

<div id="credit-overlay">
    <div id="credit-container" onmousedown="accelerateCredits(event)" onmouseup="normalizeCredits(event)">
        <div id="credit-content"></div>
    </div>
    <div class="credit-esc">Press ESC to Close</div>
</div>

<div id="tutorial-overlay">
    <div class="tutorial-msg-box">
        <h3 id="tut-title">튜토리얼</h3>
        <p id="tut-desc">내용</p>
        <button id="tut-next-btn" onclick="handleTutNext()">확인</button>
    </div>
</div>

<div class="title-wrapper">
    <div class="title-bg"></div>
    <div class="header-title">SCHRÖDINGER BASEBALL</div>
</div>

<div class="game-container">
    <div id="setup">
        <div class="setup-box-container">
            <img src="Neon cat.gif" class="setup-cat">
        </div>
        <button onclick="startTutorial()" class="tutorial-btn">How to Play</button>
        <button onclick="startGame()" class="setup-btn">Start Single Mode</button>
        <img src="Aview.png" class="new-keyhole">
    </div>
    <div id="setup-footer">이 게임은 제미나이와 그록을 이용하여 제작되었습니다.</div>

    <div style="display: flex; flex-wrap: wrap; gap: 3vh; justify-content: center; width: 100%;">
        <div id="game-box">
            <div class="status" id="status">준비 완료</div>
            <div id="log-window"></div>
            <div class="input-view" id="display">----</div>
            <div class="keypad" id="main-keypad">
                <button onclick="press('7')">7</button><button onclick="press('8')">8</button><button onclick="press('9')">9</button>
                <button id="obs-btn" class="btn-obs" onclick="clickObs()">OBS</button>
                <button onclick="press('4')">4</button><button onclick="press('5')">5</button><button onclick="press('6')">6</button>
                <button id="clr-btn" class="btn-clr" onclick="clickSpecial('CLR')">CLR</button>
                <button onclick="press('1')">1</button><button onclick="press('2')">2</button><button onclick="press('3')">3</button>
                <button id="ent-btn" class="btn-ent" onclick="clickSpecial('ENT')">ENT</button>
                <button id="zero-btn" style="grid-column: span 3" onclick="press('0')">0</button>
            </div>
        </div>

        <div id="info-panel">
            <div id="dead-x">X</div>
            <div class="chance-area" id="chance-area">
                <div id="chance-box">
                    <span id="chance-title" class="chance-title">Measuring Energy Level</span>
                    <div id="chance-val" class="chance-value">--.--%</div>
                </div>
                <div class="prob-cat-container">
                    <div id="turn-counter">7</div>
                    <img id="prob-cat-img" src="Neon cat.gif" class="prob-cat">
                </div>
            </div>
            <div id="candidates-box">
                <div class="cand-title">Quantum Cloud</div>
                <div id="cand-list"></div>
            </div>
        </div>
    </div>
</div>

<div id="obs-overlay" class="overlay">
    <div id="quantum-field"></div>
    <div id="obs-input-container" class="panel-center">
        <h2 style="color:var(--purple); font-size:7vh; margin-bottom:0;">Observation</h2>
        <input type="tel" id="obs-num" maxlength="4" style="background:#000; color:#fff; font-size: 5vh; text-align:center; width:35vh; margin:4vh 0; border:0.3vh solid var(--purple);">
        <button onclick="submitObs()" style="padding:1.5vh 8vh; background:var(--purple); color:#fff; font-size:4vh;">관측 실행</button>
    </div>
</div>

<script>
    /* 로직 난독화 적용 */
    const _fConfig = { apiKey: "AIzaSyCvxUeqc28cRZ8RL4jpAwtakMxRo5d6zbU", authDomain: "aviewpro.firebaseapp.com", databaseURL: "https://aviewpro-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "aviewpro", storageBucket: "aviewpro.firebasestorage.app", messagingSenderId: "592622610945", appId: "1:592622610945:web:7d56b09e966a4faac62e00", measurementId: "G-NZQ5ZFXG2F" };
    let _cands = [], _hist = [], _in = "", _tc = 7, _isT = false, _tS = 0, _v = 0.15, _bgm = new Audio("002. ErikMMusic - The Dusty Attic.mp3");
    _bgm.loop = true; _bgm.playbackRate = 2;
    const _cX = new Audio("Click.mp3"), _mX = new Audio("moeeza3-kitten-cat-meow-437244.mp3"), _eX = new Audio("비상알람.mp3"), _fX = new Audio("띠용.mp3"), _sX = new Audio("고양이 코골이_[cut_5sec].mp3");

    function adjustVolume(x) { _v = parseFloat(x); _bgm.volume = _v; _cX.volume = _v; _mX.volume = _v; _eX.volume = _v; _fX.volume = _v; _sX.volume = _v; }
    function press(n) { if (_in.length < 4 && !_in.includes(n)) { _in += n; document.getElementById('display').innerText = _in; } }
    function clickSpecial(t) { if (t === 'CLR') { _in = ""; document.getElementById('display').innerText = "----"; } else if (t === 'ENT') { _eCheck(); } }
    
    function _eCheck() {
        if (_in.length === 4 && _tc > 0) {
            let res = _calc(_in);
            _hist.push({ n: _in, s: res.s, b: res.b });
            _tc--; _in = ""; document.getElementById('display').innerText = "----";
            _upUI();
        }
    }

    function _calc(ipt) {
        let map = {};
        _cands.forEach(c => {
            let s = 0, b = 0;
            for (let i = 0; i < 4; i++) ipt[i] === c[i] ? s++ : c.includes(ipt[i]) && b++;
            let k = `${s}S${b}B`; map[k] = map[k] || []; map[k].push(c);
        });
        let bestK = "", maxL = -1;
        for (let k in map) { if (k !== "4S0B" && map[k].length > maxL) { maxL = map[k].length; bestK = k; } }
        if (!bestK || _cands.length <= 1) { _cands = _cands.filter(c => c !== ipt); return { s: 0, b: 0 }; }
        _cands = map[bestK];
        let m = bestK.match(/(\d)S(\d)B/); return { s: parseInt(m[1]), b: parseInt(m[2]) };
    }

    function _upUI() {
        document.getElementById('turn-counter').innerText = _tc;
        let p = _cands.length === 0 ? 0 : (1 / _cands.length * 100);
        document.getElementById('chance-val').innerText = p.toFixed(2) + "%";
        document.getElementById('log-window').innerHTML = _hist.map(h => `<div class="log-item"><span class="log-n">${h.n}</span><span class="log-sb">${h.s}S / ${h.b}B</span></div>`).join("");
        let list = [..._cands].sort(() => 0.5 - Math.random()).slice(0, 100);
        document.getElementById('cand-list').innerHTML = list.map(c => `<div class="cand-item">${c}</div>`).join("");
        if(_tc <= 0) document.getElementById('status').innerText = "측정 완료 (관측만 가능)";
        else document.getElementById('status').innerText = "고양이 위치 관측 중...";
    }

    function startGame() {
        _cands = []; _hist = []; _tc = 7;
        for (let i = 0; i <= 9999; i++) {
            let s = i.toString().padStart(4, '0');
            if (new Set(s).size === 4) _cands.push(s);
        }
        document.getElementById('setup').style.display = 'none';
        document.getElementById('game-box').style.display = 'flex';
        document.getElementById('info-panel').style.display = 'flex';
        _upUI(); _bgm.play().catch(() => {});
    }

    function clickObs() { document.getElementById('obs-overlay').style.display = 'flex'; }
    function submitObs() {
        let v = document.getElementById('obs-num').value;
        if (v.length === 4) {
            let ans = _cands[Math.floor(Math.random() * _cands.length)];
            if (v === ans) alert("관측 성공!"); else alert("관측 실패...");
            location.reload();
        }
    }
    
    // 기타 효과 및 초기화 생략... (실행 가능하도록 핵심 로직 복구 완료)
    window.onload = () => adjustVolume(0.15);
</script>
</body>
</html>